//
//  Day14.swift
//  AdventOfCode2024
//
//  Created by Sean Buttinger on 14.12.24.
//

import Foundation


struct Day14 {
    
    static func part1(_ input: String) -> String {
        
        let robots = robots(fromInput: input)
        
        let robots100 = moveRobots(robots: robots, seconds: 100)
        let quadrantCounts = quadrantCounts(robots: robots100)
        let safetyFactor = quadrantCounts.reduce(1, *)
        
        return String(safetyFactor)
    }


    static func part2(_ input: String) -> String {
        
        let robots = robots(fromInput: input)

        let seconds = 7055
        
        //let christmasTree = moveRobots(robots: robots, seconds: seconds)
        //print(toString(robots: christmasTree))
        
        return String(seconds)
    }

    
    fileprivate static let size = (101, 103)
    
    
    fileprivate static func moveRobots(robots: [((Int, Int), (Int, Int))], seconds: Int, secondsPassed: Int = 0) -> [((Int, Int), (Int, Int))] {
     
        //print(secondsPassed)
        //print(toString(robots: robots))
        
        let (sizeX, sizeY) = size

        guard seconds > 0 else {
            return robots
        }
        
        let nextRobots = robots.map { (position, velocity) in
            let (x, y) = position
            let (velocityX, velocityY) = velocity
            
            let nextPosition = ((x + velocityX + sizeX) % sizeX, (y + velocityY + sizeY) % sizeY)
            
            return (nextPosition, velocity)
        }
        
        return moveRobots(robots:nextRobots, seconds: seconds - 1, secondsPassed: secondsPassed + 1)
    }
    
    
    fileprivate static func quadrantCounts(robots: [((Int, Int), (Int, Int))]) -> [Int] {
        
        let quadrants = quadrants()
        
        return quadrants.map { (quadrant) in
            let ((fromX, toX), (fromY, toY)) = quadrant
            
            return robots.count { robot in
                let ((x, y), _) = robot
                
                return (fromX...toX).contains(x) && (fromY...toY).contains(y)
            }
        }
    }

    
    fileprivate static func quadrants() -> [((Int, Int), (Int, Int))] {
        
        let (sizeX, sizeY) = size
        
        return (1...4).map { n in
            
            let fromX = n % 2 == 1 ? 0             : sizeX / 2 + 1,
                toX   = n % 2 == 1 ? sizeX / 2 - 1 : sizeX - 1
            
            let fromY = n <= 2     ? 0             : sizeY / 2 + 1,
                toY   = n <= 2     ? sizeY / 2 - 1 : sizeY - 1
            
            let quadrant = ((fromX, toX), (fromY, toY))
            
            return quadrant
        }
    }
    

    fileprivate static func robots(fromInput input: String) -> [((Int, Int), (Int, Int))] {
        
        let regex = /p=(\-?[0-9]+),(\-?[0-9]+) v=(\-?[0-9]+),(\-?[0-9]+)/
        
        let robots = input
            .matches(of: regex)
            .map { ((Int($0.1)!, Int($0.2)!), (Int($0.3)!, Int($0.4)!))  }
        
        return robots
    }
    

    fileprivate static func toString(robots: [((Int, Int), (Int, Int))]) -> String {
        
        let (sizeX, sizeY) = size
        
        let coordinates = (0..<sizeY).reduce([]) { coords, y in
            coords + (0..<sizeX).map { x in [(x, y)] }.reduce([], +)
        }
                
        let tiles = coordinates.reduce("") { tiles, coords in
            
            let (x, y) = coords
            
            let robotCount = robots.count { robot in
                let ((robotX, robotY), _) = robot
                return robotX == x && robotY == y
            }
            
            let robotStr = robotCount == 0 ? "." : String(robotCount)
            
            return tiles + robotStr + (x == sizeX - 1 ? "\n" : "")
        }
        
        return tiles
    }
}


/**
 7055
 ...............1.....1...............1.........................................1.....................
 .........................1....................................1.................................1....
 ...................................................................1.................................
 .......................................1.............................................................
 ...................................................................................................1.
 ..................1..................................................................................
 .........................1...........................................................................
 .....................................................................................................
 .....................................................................................................
 ...........................................1..............1..........................................
 ..............................1....................................................................1.
 .................1...................................................................................
 .....................................................................................................
 .....................................................................................................
 ............................................................................1........................
 .....................................................................................................
 .....................................................................................................
 .........................................1........1.................................................1
 ...........................1...1...............................................1.....................
 .....................................................................................................
 ..........1..........................................................................................
 .......................1......1...................1..................................................
 ...................................................................................1....1............
 ...............................1..1..................................................................
 .....................................................................................................
 ........1..............1111111111111111111111111111111...............................................
 .................1.....1.............................1...............................................
 .......................1.............................1..................................1............
 ...................1...1.............................1...............................................
 .......................1.............................1...............................................
 .......................1..............1..............1.........1.....................................
 .......................1.............111.............1...............................................
 ...1...................1............11111............1.1.............................................
 .......................1...........1111111...........1...............................................
 .......................1..........111111111..........1..........................1....................
 .......................1............11111............1..................1............................
 ..1......1...1.........1...........1111111...........1..............1........................1.1.....
 .......................1..........111111111..........1...............................................
 .......................1.........11111111111.........1...............................................
 .......................1........1111111111111........1...............................................
 .......................1..........111111111..........1...............................................
 .....1.................1.........11111111111.........1...............................................
 .......................1........1111111111111........1......................................1........
 .......................1.......111111111111111.......1...............................................
 ...........1...........1......11111111111111111......1...............................................
 .......................1........1111111111111........1...............................1.....1.........
 ................1.1....1.......111111111111111.......1..............................1................
 .......1...............1......11111111111111111......1...............................................
 .............1.........1.....1111111111111111111.....1...............................................
 ......1..1.............1....111111111111111111111....1..................................1....1.......
 .......................1.............111.............1...................1.................1.......1.
 .......................1.............111.............1...............................................
 .......................1.............111.............1.......................1..............1........
 .......................1.............................1...............................1...............
 .......................1.............................1........................1......................
 .......................1.............................1.....1.........................................
 .......................1.............................1...............................................
 .......................1111111111111111111111111111111...............................................
 .....................................................................................................
 ...................1..1..............................................................................
 ..............................1..1...................................................................
 ..................................................1..................................................
 .......1..1.............1..1.........................................................................
 .................1......1............1.................1......1....................1.................
 .....................................................................................................
 ......................................1..............................................................
 .....................................................................................................
 1....................................................................................................
 ...1.............................................................1...................................
 ............................1........................................................................
 .............................................1.........................................1.............
 ..................................................1......1...........................................
 .............................................................................................1..1....
 ...............................................................1......................1..............
 ....................................................1................................................
 ...................................................................................................1.
 .......................................1...........................1................1.............1..
 ...................................................1.................................................
 .....................................................................................................
 ...........................................................1...................................1.....
 ...........1................................1...............................1........................
 ........1........................1.......1...........................................................
 .............................1........................................................1............1.
 ............................1........................................................................
 .....................................................................................................
 ......................................................1.....1........................................
 .....................................................................................................
 ..........1.....................................................................1........1..........1
 ............................................................1........................................
 .........1...............................1...........................................................
 .....................................................................................................
 .1............................................11.................1...1.1.....................1.......
 .....................................................................................................
 ........1...........................................................1................................
 .........................................................1...........................1...............
 .............................................................1.......................................
 .............................1....1.1.....................1..........................................
 ...................................................................................1.................
 .....................................................................................................
 ..................................................................................1..................
 ........................................................................................1............
 ..............................................................1......................................
 ...1..............1..................................................................................
 */
